<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Panel.ViewModels"
             x:Class="Panel.Views.LoginPage"
             Title="Login">

    <Grid BackgroundColor="#F0F0F0">
        <ScrollView VerticalScrollBarVisibility="Always">
            <Frame VerticalOptions="Center" 
               HorizontalOptions="Center"
               WidthRequest="450"
               Padding="40" 
               CornerRadius="12" 
               BackgroundColor="White" 
               HasShadow="True"
               BorderColor="#E5E7EB">
            
            <VerticalStackLayout Spacing="25">
                
                <Image Source="logoconsultoria.jpg" 
                       HeightRequest="280" 
                       WidthRequest="280" 
                       HorizontalOptions="Center" 
                       Margin="0,0,0,10"
                       Aspect="AspectFit"/>

                <Label Text="Bienvenido" 
                       FontSize="26" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" 
                       TextColor="#111827"/>
                
                <VerticalStackLayout Spacing="15">
                    <Entry Placeholder="Usuario" 
                           Text="{Binding Username}" 
                           TextColor="Black"
                           HeightRequest="45"
                           PlaceholderColor="#9CA3AF"
                           ClearButtonVisibility="WhileEditing"/>
                    
                    <Entry Placeholder="Contraseña" 
                           Text="{Binding Password}" 
                           TextColor="Black"
                           HeightRequest="45"
                           PlaceholderColor="#9CA3AF"
                           IsPassword="True"/>
                </VerticalStackLayout>
                
                <Label Text="{Binding ErrorMessage}" 
                       TextColor="#EF4444" 
                       FontSize="Small"
                       HeightRequest="20"
                       HorizontalOptions="Center"/>
                
                <Button Text="Iniciar Sesión" 
                        Command="{Binding LoginCommand}" 
                        BackgroundColor="#2563EB" 
                        TextColor="White" 
                        CornerRadius="8" 
                        HeightRequest="50"
                        FontAttributes="Bold"
                        Margin="0,10,0,0"/>

                <!-- Toggle para Sincronización -->
                <Label Text="¿Primera vez? Sincronizar Datos" 
                       FontSize="12" 
                       TextColor="#4B5563" 
                       HorizontalOptions="Center" 
                       FontAttributes="Bold"
                       TextDecorations="Underline"
                       Margin="0,20,0,0">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ToggleSyncCommand}"/>
                    </Label.GestureRecognizers>
                </Label>

                <!-- Sección Sincronización Inicial (Oculta por defecto) -->
                <Border Stroke="#D1D5DB" 
                        StrokeShape="RoundRectangle 8" 
                        BackgroundColor="#F9FAFB" 
                        Padding="15" 
                        Margin="0,10,0,0"
                        IsVisible="{Binding IsSyncVisible}">
                    <VerticalStackLayout Spacing="10">
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                            <Entry Grid.Column="0" Placeholder="IP Servidor (ej. 192.168.1.5)" Text="{Binding SyncIp}" FontSize="12" BackgroundColor="White" TextColor="Black" VerticalOptions="Center"/>
                            <Button Grid.Column="1" Text="Sync" Command="{Binding SincronizarInicialCommand}" FontSize="12" Padding="15,0" HeightRequest="38" BackgroundColor="#2563EB" TextColor="White" VerticalOptions="Center"/>
                        </Grid>
                        
                        <ActivityIndicator IsRunning="{Binding IsSyncing}" IsVisible="{Binding IsSyncing}" Color="#2563EB" HeightRequest="20"/>
                        <Label Text="{Binding SyncStatus}" FontSize="11" TextColor="#2563EB" HorizontalOptions="Center">
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding SyncStatus}" Value="">
                                    <Setter Property="IsVisible" Value="False"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SyncStatus}" Value="{x:Null}">
                                    <Setter Property="IsVisible" Value="False"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </Frame>
        </ScrollView>
    </Grid>

</ContentPage>
