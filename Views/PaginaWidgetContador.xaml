<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Panel.ViewModels"
             x:Class="Panel.Views.PaginaWidgetContador"
             Title="JAZER Widget"
             BackgroundColor="Transparent">

    <!-- Tarjeta compacta del widget -->
    <Border Stroke="#E5E7EB" 
            StrokeThickness="1"
            BackgroundColor="White"
            WidthRequest="280"
            HeightRequest="220"
            HorizontalOptions="Center"
            VerticalOptions="Center">
        <Border.Shadow>
            <Shadow Brush="Black" Offset="2,2" Radius="5" Opacity="0.1"/>
        </Border.Shadow>

        <Grid RowDefinitions="32,*,20">
            <!-- Encabezado con identidad y acciÃ³n de expandir -->
            <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Padding="12,0" BackgroundColor="White">
             
                <Label Grid.Column="0" Text="JZ" 
                       TextColor="#1E3A8A" FontAttributes="Bold" FontSize="14" 
                       VerticalOptions="Center"/>
                
                <VerticalStackLayout Grid.Column="1" Margin="8,0,0,0" VerticalOptions="Center" Spacing="0">
                    <Label Text="{Binding NombreContador}" FontSize="12" LineBreakMode="TailTruncation" TextColor="#333"/>
                    <HorizontalStackLayout Spacing="4">
                        <Ellipse WidthRequest="6" HeightRequest="6" Fill="#10b981" VerticalOptions="Center"/>
                        <Label Text="En lÃ­nea" FontSize="10" TextColor="Gray"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>

                <Button Grid.Column="2" 
                        Text="â¤¢" 
                        FontSize="18"
                        BackgroundColor="Transparent" 
                        TextColor="Gray"
                        Padding="0"
                        WidthRequest="28" HeightRequest="28"
                        Command="{Binding ExpandirCentroControlCommand}"/>
            </Grid>

            <!-- Lista de tareas rÃ¡pidas -->
            <CollectionView Grid.Row="1" ItemsSource="{Binding Tareas}" Margin="0,4">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*,Auto" Padding="12,4">
                            
                            <CheckBox Grid.Row="0" Grid.Column="0" IsChecked="{Binding Estado, Converter={StaticResource StatusToBoolConverter}}" 
                                      VerticalOptions="Center"/>
                            <Label Grid.Row="0" Grid.Column="1" Text="{Binding Titulo}" 
                                   FontSize="11" VerticalOptions="Center" Margin="8,0,0,0" LineBreakMode="TailTruncation"/>
                         
                            <Label Grid.Row="0" Grid.Column="2" Text="â°" FontSize="12" VerticalOptions="Center"/>

                            <HorizontalStackLayout Grid.Row="1" Grid.Column="1" Spacing="8" Margin="8,0,0,0">
                                <Label Text="{Binding FechaAsignacion, StringFormat='ðŸ“… {0:MMM dd}'}" FontSize="9" TextColor="#9CA3AF"/>
                                <Label Text="{Binding FechaVencimiento, StringFormat='â° {0:MMM dd}'}" FontSize="9" TextColor="#9CA3AF"/>
                            </HorizontalStackLayout>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <Label Text="No hay tareas pendientes" 
                           FontSize="12" TextColor="Gray" 
                           HorizontalOptions="Center" VerticalOptions="Center"/>
                </CollectionView.EmptyView>
            </CollectionView>

            <!-- Aviso de nuevos mensajes -->
            <Grid Grid.Row="2" BackgroundColor="#DBEAFE" IsVisible="{Binding MensajesNuevos, Converter={StaticResource IntToBoolConverter}}">
                <Label Text="{Binding MensajesNuevos, StringFormat='ðŸ”” {0} mensaje(s) nuevo(s)'}" 
                       TextColor="#1E40AF" FontSize="10" 
                       HorizontalOptions="Center" VerticalOptions="Center"/>
            </Grid>
        </Grid>
    </Border>

</ContentPage>
